[phases.setup]
nixPkgs = ["nodejs", "python311"]

[phases.install]
cmds = [
    "echo '=== Installing Node dependencies ==='",
    "npm install",
    "echo '=== Cleaning dist directory ==='",
    "rm -rf dist || true",
    "echo '=== Running Vite build ==='",
    "npm run build || (echo 'Build failed!' && exit 1)",
    "echo '=== Verifying build output ==='",
    "ls -la || echo 'Current directory listing:'",
    "ls -la dist || echo 'ERROR: dist directory not created!'",
    "ls -la dist/assets 2>/dev/null || echo 'WARNING: assets directory does not exist'",
    "echo '=== Installing Python dependencies ==='",
    "python3 -m pip install --upgrade pip",
    "python3 -m pip install -r requirements.txt"
]

[start]
cmd = "gunicorn wsgi:application --chdir ./src/ --bind 0.0.0.0:$PORT"

