[phases.setup]
nixPkgs = ["nodejs", "python311", "python311Packages.pip", "curl"]

[phases.install]
cmds = [
    "echo '=== Installing Node dependencies ==='",
    "npm install",
    "echo '=== Cleaning dist directory ==='",
    "rm -rf dist || true",
    "echo '=== Running Vite build ==='",
    "npm run build || (echo 'Build failed!' && exit 1)",
    "echo '=== Verifying build output ==='",
    "ls -la || echo 'Current directory listing:'",
    "ls -la dist || echo 'ERROR: dist directory not created!'",
    "ls -la dist/assets 2>/dev/null || echo 'WARNING: assets directory does not exist'",
    "echo '=== Installing Python dependencies ==='",
    "curl -sS https://bootstrap.pypa.io/get-pip.py | python3 || echo 'pip already installed'",
    "python3 -m pip install --upgrade pip --break-system-packages || python3 -m pip install --upgrade pip",
    "python3 -m pip install -r requirements.txt --break-system-packages || python3 -m pip install -r requirements.txt"
]

[start]
cmd = "gunicorn wsgi:application --chdir ./src/ --bind 0.0.0.0:$PORT"

